version: '3'
services:

  database:
    image: 'mongo'
    container_name: 'database'
    ports:
      - '27017-27019:27017-27019'
  queue:
    image: 'rabbitmq'
    container_name: 'queue'
    ports:
      - '5672:5672'
    environment:
      - RABBITMQ_DEFAULT_USER=user
      - RABBITMQ_DEFAULT_PASS=password
  web:
      build: .
      container_name: 'web'
      volumes:
        - ./src:/usr/src/app/src
      links:
        - queue
        - database
      environment:
        - LOGIN_PASS=Foo
        - JWT_SECRET=Foo
        - API_SECRET=Foo
        - MONGODB_URI=mongodb://database:27017/heroku_qb9h5dc7
        - PORT=5000
        - SHOW_ERROR_PAGES=true
        - WINSTON_LOG_LEVEL=debug
        - WEB_CONCURRENCY=1
        - MESSAGE_QUEUE_URI=amqp://user:password@queue
        - RESTART_TIMEOUT=5000
        - SERVICE_NAME=docker
      ports:
        - '5000:5000'
